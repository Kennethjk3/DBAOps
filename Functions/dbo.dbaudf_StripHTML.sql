SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE   FUNCTION [dbo].[dbaudf_StripHTML] (@HTMLText nVARCHAR(MAX))
RETURNS nVARCHAR(MAX) AS
BEGIN
	SET @HTMLText = REPLACE(@HTMLText, '<br>',      CHAR(13)+CHAR(10))
	SET @HTMLText = REPLACE(@HTMLText, '</p>',		CHAR(13)+CHAR(10))
	SET @HTMLText = REPLACE(@HTMLText, '</span>',	CHAR(13)+CHAR(10))
	SET @HTMLText = REPLACE(@HTMLText, '<p>',		'')
	SET @HTMLText = REPLACE(@HTMLText, '<span>',	'')

    DECLARE @Start INT
    DECLARE @End INT
    DECLARE @Length INT
    SET @Start = CHARINDEX('<',@HTMLText)
    SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText))
    SET @Length = (@End - @Start) + 1
    WHILE @Start > 0 AND @End > 0 AND @Length > 0
    BEGIN
        SET @HTMLText = STUFF(@HTMLText,@Start,@Length,'')
        SET @Start = CHARINDEX('<',@HTMLText)
        SET @End = CHARINDEX('>',@HTMLText,CHARINDEX('<',@HTMLText))
        SET @Length = (@End - @Start) + 1
    END

	SET @HTMLText = REPLACE(@HTMLText, '&amp;',      NCHAR(38))
	SET @HTMLText = REPLACE(@HTMLText, '&lt;',       NCHAR(60))
	SET @HTMLText = REPLACE(@HTMLText, '&gt;',       NCHAR(62))
	SET @HTMLText = REPLACE(@HTMLText, '&Agrave;',   NCHAR(192))
	SET @HTMLText = REPLACE(@HTMLText, '&Aacute;',   NCHAR(193))
	SET @HTMLText = REPLACE(@HTMLText, '&Acirc;',    NCHAR(194))
	SET @HTMLText = REPLACE(@HTMLText, '&Atilde;',   NCHAR(195))
	SET @HTMLText = REPLACE(@HTMLText, '&Auml;',     NCHAR(196))
	SET @HTMLText = REPLACE(@HTMLText, '&Aring;',    NCHAR(197))
	SET @HTMLText = REPLACE(@HTMLText, '&AElig;',    NCHAR(198))
	SET @HTMLText = REPLACE(@HTMLText, '&Ccedil;',   NCHAR(199))
	SET @HTMLText = REPLACE(@HTMLText, '&Egrave;',   NCHAR(200))
	SET @HTMLText = REPLACE(@HTMLText, '&Eacute;',   NCHAR(201))
	SET @HTMLText = REPLACE(@HTMLText, '&Ecirc;',    NCHAR(202))
	SET @HTMLText = REPLACE(@HTMLText, '&Euml;',     NCHAR(203))
	SET @HTMLText = REPLACE(@HTMLText, '&Igrave;',   NCHAR(204))
	SET @HTMLText = REPLACE(@HTMLText, '&Iacute;',   NCHAR(205))
	SET @HTMLText = REPLACE(@HTMLText, '&Icirc;',    NCHAR(206))
	SET @HTMLText = REPLACE(@HTMLText, '&Iuml;',     NCHAR(207))
	SET @HTMLText = REPLACE(@HTMLText, '&ETH;',      NCHAR(208))
	SET @HTMLText = REPLACE(@HTMLText, '&Ntilde;',   NCHAR(209))
	SET @HTMLText = REPLACE(@HTMLText, '&Ograve;',   NCHAR(210))
	SET @HTMLText = REPLACE(@HTMLText, '&Oacute;',   NCHAR(211))
	SET @HTMLText = REPLACE(@HTMLText, '&Ocirc;',    NCHAR(212))
	SET @HTMLText = REPLACE(@HTMLText, '&Otilde;',   NCHAR(213))
	SET @HTMLText = REPLACE(@HTMLText, '&Ouml;',     NCHAR(214))
	SET @HTMLText = REPLACE(@HTMLText, '&Oslash;',   NCHAR(216))
	SET @HTMLText = REPLACE(@HTMLText, '&Ugrave;',   NCHAR(217))
	SET @HTMLText = REPLACE(@HTMLText, '&Uacute;',   NCHAR(218))
	SET @HTMLText = REPLACE(@HTMLText, '&Ucirc;',    NCHAR(219))
	SET @HTMLText = REPLACE(@HTMLText, '&Uuml;',     NCHAR(220))
	SET @HTMLText = REPLACE(@HTMLText, '&Yacute;',   NCHAR(221))
	SET @HTMLText = REPLACE(@HTMLText, '&THORN;',    NCHAR(222))
	SET @HTMLText = REPLACE(@HTMLText, '&szlig;',    NCHAR(223))
	SET @HTMLText = REPLACE(@HTMLText, '&agrave;',   NCHAR(224))
	SET @HTMLText = REPLACE(@HTMLText, '&aacute;',   NCHAR(225))
	SET @HTMLText = REPLACE(@HTMLText, '&acirc;',    NCHAR(226))
	SET @HTMLText = REPLACE(@HTMLText, '&atilde;',   NCHAR(227))
	SET @HTMLText = REPLACE(@HTMLText, '&auml;',     NCHAR(228))
	SET @HTMLText = REPLACE(@HTMLText, '&aring;',    NCHAR(229))
	SET @HTMLText = REPLACE(@HTMLText, '&aelig;',    NCHAR(230))
	SET @HTMLText = REPLACE(@HTMLText, '&ccedil;',   NCHAR(231))
	SET @HTMLText = REPLACE(@HTMLText, '&egrave;',   NCHAR(232))
	SET @HTMLText = REPLACE(@HTMLText, '&eacute;',   NCHAR(233))
	SET @HTMLText = REPLACE(@HTMLText, '&ecirc;',    NCHAR(234))
	SET @HTMLText = REPLACE(@HTMLText, '&euml;',     NCHAR(235))
	SET @HTMLText = REPLACE(@HTMLText, '&igrave;',   NCHAR(236))
	SET @HTMLText = REPLACE(@HTMLText, '&iacute;',   NCHAR(237))
	SET @HTMLText = REPLACE(@HTMLText, '&icirc;',    NCHAR(238))
	SET @HTMLText = REPLACE(@HTMLText, '&iuml;',     NCHAR(239))
	SET @HTMLText = REPLACE(@HTMLText, '&eth;',      NCHAR(240))
	SET @HTMLText = REPLACE(@HTMLText, '&ntilde;',   NCHAR(241))
	SET @HTMLText = REPLACE(@HTMLText, '&ograve;',   NCHAR(242))
	SET @HTMLText = REPLACE(@HTMLText, '&oacute;',   NCHAR(243))
	SET @HTMLText = REPLACE(@HTMLText, '&ocirc;',    NCHAR(244))
	SET @HTMLText = REPLACE(@HTMLText, '&otilde;',   NCHAR(245))
	SET @HTMLText = REPLACE(@HTMLText, '&ouml;',     NCHAR(246))
	SET @HTMLText = REPLACE(@HTMLText, '&oslash;',   NCHAR(248))
	SET @HTMLText = REPLACE(@HTMLText, '&ugrave;',   NCHAR(249))
	SET @HTMLText = REPLACE(@HTMLText, '&uacute;',   NCHAR(250))
	SET @HTMLText = REPLACE(@HTMLText, '&ucirc;',    NCHAR(251))
	SET @HTMLText = REPLACE(@HTMLText, '&uuml;',     NCHAR(252))
	SET @HTMLText = REPLACE(@HTMLText, '&yacute;',   NCHAR(253))
	SET @HTMLText = REPLACE(@HTMLText, '&thorn;',    NCHAR(254))
	SET @HTMLText = REPLACE(@HTMLText, '&yuml;',     NCHAR(255))
	SET @HTMLText = REPLACE(@HTMLText, '&nbsp;',     NCHAR(160))
	SET @HTMLText = REPLACE(@HTMLText, '&iexcl;',    NCHAR(161))
	SET @HTMLText = REPLACE(@HTMLText, '&cent;',     NCHAR(162))
	SET @HTMLText = REPLACE(@HTMLText, '&pound;',    NCHAR(163))
	SET @HTMLText = REPLACE(@HTMLText, '&curren;',   NCHAR(164))
	SET @HTMLText = REPLACE(@HTMLText, '&yen;',      NCHAR(165))
	SET @HTMLText = REPLACE(@HTMLText, '&brvbar;',   NCHAR(166))
	SET @HTMLText = REPLACE(@HTMLText, '&sect;',     NCHAR(167))
	SET @HTMLText = REPLACE(@HTMLText, '&uml;',      NCHAR(168))
	SET @HTMLText = REPLACE(@HTMLText, '&copy;',     NCHAR(169))
	SET @HTMLText = REPLACE(@HTMLText, '&ordf;',     NCHAR(170))
	SET @HTMLText = REPLACE(@HTMLText, '&laquo;',    NCHAR(171))
	SET @HTMLText = REPLACE(@HTMLText, '&not;',      NCHAR(172))
	SET @HTMLText = REPLACE(@HTMLText, '&shy;',      NCHAR(173))
	SET @HTMLText = REPLACE(@HTMLText, '&reg;',      NCHAR(174))
	SET @HTMLText = REPLACE(@HTMLText, '&macr;',     NCHAR(175))
	SET @HTMLText = REPLACE(@HTMLText, '&deg;',      NCHAR(176))
	SET @HTMLText = REPLACE(@HTMLText, '&plusmn;',   NCHAR(177))
	SET @HTMLText = REPLACE(@HTMLText, '&sup2;',     NCHAR(178))
	SET @HTMLText = REPLACE(@HTMLText, '&sup3;',     NCHAR(179))
	SET @HTMLText = REPLACE(@HTMLText, '&acute;',    NCHAR(180))
	SET @HTMLText = REPLACE(@HTMLText, '&micro;',    NCHAR(181))
	SET @HTMLText = REPLACE(@HTMLText, '&para;',     NCHAR(182))
	SET @HTMLText = REPLACE(@HTMLText, '&cedil;',    NCHAR(184))
	SET @HTMLText = REPLACE(@HTMLText, '&sup1;',     NCHAR(185))
	SET @HTMLText = REPLACE(@HTMLText, '&ordm;',     NCHAR(186))
	SET @HTMLText = REPLACE(@HTMLText, '&raquo;',    NCHAR(187))
	SET @HTMLText = REPLACE(@HTMLText, '&frac14;',   NCHAR(188))
	SET @HTMLText = REPLACE(@HTMLText, '&frac12;',   NCHAR(189))
	SET @HTMLText = REPLACE(@HTMLText, '&frac34;',   NCHAR(190))
	SET @HTMLText = REPLACE(@HTMLText, '&iquest;',   NCHAR(191))
	SET @HTMLText = REPLACE(@HTMLText, '&times;',    NCHAR(215))
	SET @HTMLText = REPLACE(@HTMLText, '&divide;',   NCHAR(247))
	SET @HTMLText = REPLACE(@HTMLText, '&forall;',   NCHAR(8704))
	SET @HTMLText = REPLACE(@HTMLText, '&part;',     NCHAR(8706))
	SET @HTMLText = REPLACE(@HTMLText, '&exist;',    NCHAR(8707))
	SET @HTMLText = REPLACE(@HTMLText, '&empty;',    NCHAR(8709))
	SET @HTMLText = REPLACE(@HTMLText, '&nabla;',    NCHAR(8711))
	SET @HTMLText = REPLACE(@HTMLText, '&isin;',     NCHAR(8712))
	SET @HTMLText = REPLACE(@HTMLText, '&notin;',    NCHAR(8713))
	SET @HTMLText = REPLACE(@HTMLText, '&ni;',       NCHAR(8715))
	SET @HTMLText = REPLACE(@HTMLText, '&prod;',     NCHAR(8719))
	SET @HTMLText = REPLACE(@HTMLText, '&sum;',      NCHAR(8721))
	SET @HTMLText = REPLACE(@HTMLText, '&minus;',    NCHAR(8722))
	SET @HTMLText = REPLACE(@HTMLText, '&lowast;',   NCHAR(8727))
	SET @HTMLText = REPLACE(@HTMLText, '&radic;',    NCHAR(8730))
	SET @HTMLText = REPLACE(@HTMLText, '&prop;',     NCHAR(8733))
	SET @HTMLText = REPLACE(@HTMLText, '&infin;',    NCHAR(8734))
	SET @HTMLText = REPLACE(@HTMLText, '&ang;',      NCHAR(8736))
	SET @HTMLText = REPLACE(@HTMLText, '&and;',      NCHAR(8743))
	SET @HTMLText = REPLACE(@HTMLText, '&or;',       NCHAR(8744))
	SET @HTMLText = REPLACE(@HTMLText, '&cap;',      NCHAR(8745))
	SET @HTMLText = REPLACE(@HTMLText, '&cup;',      NCHAR(8746))
	SET @HTMLText = REPLACE(@HTMLText, '&int;',      NCHAR(8747))
	SET @HTMLText = REPLACE(@HTMLText, '&there4;',   NCHAR(8756))
	SET @HTMLText = REPLACE(@HTMLText, '&sim;',      NCHAR(8764))
	SET @HTMLText = REPLACE(@HTMLText, '&cong;',     NCHAR(8773))
	SET @HTMLText = REPLACE(@HTMLText, '&asymp;',    NCHAR(8776))
	SET @HTMLText = REPLACE(@HTMLText, '&ne;',       NCHAR(8800))
	SET @HTMLText = REPLACE(@HTMLText, '&equiv;',    NCHAR(8801))
	SET @HTMLText = REPLACE(@HTMLText, '&le;',       NCHAR(8804))
	SET @HTMLText = REPLACE(@HTMLText, '&ge;',       NCHAR(8805))
	SET @HTMLText = REPLACE(@HTMLText, '&sub;',      NCHAR(8834))
	SET @HTMLText = REPLACE(@HTMLText, '&sup;',      NCHAR(8835))
	SET @HTMLText = REPLACE(@HTMLText, '&nsub;',     NCHAR(8836))
	SET @HTMLText = REPLACE(@HTMLText, '&sube;',     NCHAR(8838))
	SET @HTMLText = REPLACE(@HTMLText, '&supe;',     NCHAR(8839))
	SET @HTMLText = REPLACE(@HTMLText, '&oplus;',    NCHAR(8853))
	SET @HTMLText = REPLACE(@HTMLText, '&otimes;',   NCHAR(8855))
	SET @HTMLText = REPLACE(@HTMLText, '&perp;',     NCHAR(8869))
	SET @HTMLText = REPLACE(@HTMLText, '&sdot;',     NCHAR(8901))
	SET @HTMLText = REPLACE(@HTMLText, '&Alpha;',    NCHAR(913))
	SET @HTMLText = REPLACE(@HTMLText, '&Beta;',     NCHAR(914))
	SET @HTMLText = REPLACE(@HTMLText, '&Gamma;',    NCHAR(915))
	SET @HTMLText = REPLACE(@HTMLText, '&Delta;',    NCHAR(916))
	SET @HTMLText = REPLACE(@HTMLText, '&Epsilon;',  NCHAR(917))
	SET @HTMLText = REPLACE(@HTMLText, '&Zeta;',     NCHAR(918))
	SET @HTMLText = REPLACE(@HTMLText, '&Eta;',      NCHAR(919))
	SET @HTMLText = REPLACE(@HTMLText, '&Theta;',    NCHAR(920))
	SET @HTMLText = REPLACE(@HTMLText, '&Iota;',     NCHAR(921))
	SET @HTMLText = REPLACE(@HTMLText, '&Kappa;',    NCHAR(922))
	SET @HTMLText = REPLACE(@HTMLText, '&Lambda;',   NCHAR(923))
	SET @HTMLText = REPLACE(@HTMLText, '&Mu;',       NCHAR(924))
	SET @HTMLText = REPLACE(@HTMLText, '&Nu;',       NCHAR(925))
	SET @HTMLText = REPLACE(@HTMLText, '&Xi;',       NCHAR(926))
	SET @HTMLText = REPLACE(@HTMLText, '&Omicron;',  NCHAR(927))
	SET @HTMLText = REPLACE(@HTMLText, '&Pi;',       NCHAR(928))
	SET @HTMLText = REPLACE(@HTMLText, '&Rho;',      NCHAR(929))
	SET @HTMLText = REPLACE(@HTMLText, '&Sigma;',    NCHAR(931))
	SET @HTMLText = REPLACE(@HTMLText, '&Tau;',      NCHAR(932))
	SET @HTMLText = REPLACE(@HTMLText, '&Upsilon;',  NCHAR(933))
	SET @HTMLText = REPLACE(@HTMLText, '&Phi;',      NCHAR(934))
	SET @HTMLText = REPLACE(@HTMLText, '&Chi;',      NCHAR(935))
	SET @HTMLText = REPLACE(@HTMLText, '&Psi;',      NCHAR(936))
	SET @HTMLText = REPLACE(@HTMLText, '&Omega;',    NCHAR(937))
	SET @HTMLText = REPLACE(@HTMLText, '&alpha;',    NCHAR(945))
	SET @HTMLText = REPLACE(@HTMLText, '&beta;',     NCHAR(946))
	SET @HTMLText = REPLACE(@HTMLText, '&gamma;',    NCHAR(947))
	SET @HTMLText = REPLACE(@HTMLText, '&delta;',    NCHAR(948))
	SET @HTMLText = REPLACE(@HTMLText, '&epsilon;',  NCHAR(949))
	SET @HTMLText = REPLACE(@HTMLText, '&zeta;',     NCHAR(950))
	SET @HTMLText = REPLACE(@HTMLText, '&eta;',      NCHAR(951))
	SET @HTMLText = REPLACE(@HTMLText, '&theta;',    NCHAR(952))
	SET @HTMLText = REPLACE(@HTMLText, '&iota;',     NCHAR(953))
	SET @HTMLText = REPLACE(@HTMLText, '&kappa;',    NCHAR(954))
	SET @HTMLText = REPLACE(@HTMLText, '&lambda;',   NCHAR(955))
	SET @HTMLText = REPLACE(@HTMLText, '&mu;',       NCHAR(956))
	SET @HTMLText = REPLACE(@HTMLText, '&nu;',       NCHAR(957))
	SET @HTMLText = REPLACE(@HTMLText, '&xi;',       NCHAR(958))
	SET @HTMLText = REPLACE(@HTMLText, '&omicron;',  NCHAR(959))
	SET @HTMLText = REPLACE(@HTMLText, '&pi;',       NCHAR(960))
	SET @HTMLText = REPLACE(@HTMLText, '&rho;',      NCHAR(961))
	SET @HTMLText = REPLACE(@HTMLText, '&sigmaf;',   NCHAR(962))
	SET @HTMLText = REPLACE(@HTMLText, '&sigma;',    NCHAR(963))
	SET @HTMLText = REPLACE(@HTMLText, '&tau;',      NCHAR(964))
	SET @HTMLText = REPLACE(@HTMLText, '&upsilon;',  NCHAR(965))
	SET @HTMLText = REPLACE(@HTMLText, '&phi;',      NCHAR(966))
	SET @HTMLText = REPLACE(@HTMLText, '&chi;',      NCHAR(967))
	SET @HTMLText = REPLACE(@HTMLText, '&psi;',      NCHAR(968))
	SET @HTMLText = REPLACE(@HTMLText, '&omega;',    NCHAR(969))
	SET @HTMLText = REPLACE(@HTMLText, '&thetasym;', NCHAR(977))
	SET @HTMLText = REPLACE(@HTMLText, '&upsih;',    NCHAR(978))
	SET @HTMLText = REPLACE(@HTMLText, '&piv;',      NCHAR(982))
	SET @HTMLText = REPLACE(@HTMLText, '&OElig;',    NCHAR(338))
	SET @HTMLText = REPLACE(@HTMLText, '&oelig;',    NCHAR(339))
	SET @HTMLText = REPLACE(@HTMLText, '&Scaron;',   NCHAR(352))
	SET @HTMLText = REPLACE(@HTMLText, '&scaron;',   NCHAR(353))
	SET @HTMLText = REPLACE(@HTMLText, '&Yuml;',     NCHAR(376))
	SET @HTMLText = REPLACE(@HTMLText, '&fnof;',     NCHAR(402))
	SET @HTMLText = REPLACE(@HTMLText, '&circ;',     NCHAR(710))
	SET @HTMLText = REPLACE(@HTMLText, '&tilde;',    NCHAR(732))
	SET @HTMLText = REPLACE(@HTMLText, '&ensp;',     NCHAR(8194))
	SET @HTMLText = REPLACE(@HTMLText, '&emsp;',     NCHAR(8195))
	SET @HTMLText = REPLACE(@HTMLText, '&thinsp;',   NCHAR(8201))
	SET @HTMLText = REPLACE(@HTMLText, '&zwnj;',     NCHAR(8204))
	SET @HTMLText = REPLACE(@HTMLText, '&zwj;',      NCHAR(8205))
	SET @HTMLText = REPLACE(@HTMLText, '&lrm;',      NCHAR(8206))
	SET @HTMLText = REPLACE(@HTMLText, '&rlm;',      NCHAR(8207))
	SET @HTMLText = REPLACE(@HTMLText, '&ndash;',    NCHAR(8211))
	SET @HTMLText = REPLACE(@HTMLText, '&mdash;',    NCHAR(8212))
	SET @HTMLText = REPLACE(@HTMLText, '&lsquo;',    NCHAR(8216))
	SET @HTMLText = REPLACE(@HTMLText, '&rsquo;',    NCHAR(8217))
	SET @HTMLText = REPLACE(@HTMLText, '&sbquo;',    NCHAR(8218))
	SET @HTMLText = REPLACE(@HTMLText, '&ldquo;',    NCHAR(8220))
	SET @HTMLText = REPLACE(@HTMLText, '&rdquo;',    NCHAR(8221))
	SET @HTMLText = REPLACE(@HTMLText, '&bdquo;',    NCHAR(8222))
	SET @HTMLText = REPLACE(@HTMLText, '&dagger;',   NCHAR(8224))
	SET @HTMLText = REPLACE(@HTMLText, '&Dagger;',   NCHAR(8225))
	SET @HTMLText = REPLACE(@HTMLText, '&bull;',     NCHAR(8226))
	SET @HTMLText = REPLACE(@HTMLText, '&hellip;',   NCHAR(8230))
	SET @HTMLText = REPLACE(@HTMLText, '&permil;',   NCHAR(8240))
	SET @HTMLText = REPLACE(@HTMLText, '&prime;',    NCHAR(8242))
	SET @HTMLText = REPLACE(@HTMLText, '&Prime;',    NCHAR(8243))
	SET @HTMLText = REPLACE(@HTMLText, '&lsaquo;',   NCHAR(8249))
	SET @HTMLText = REPLACE(@HTMLText, '&rsaquo;',   NCHAR(8250))
	SET @HTMLText = REPLACE(@HTMLText, '&oline;',    NCHAR(8254))
	SET @HTMLText = REPLACE(@HTMLText, '&euro;',     NCHAR(8364))
	SET @HTMLText = REPLACE(@HTMLText, '&trade;',    NCHAR(8482))
	SET @HTMLText = REPLACE(@HTMLText, '&larr;',     NCHAR(8592))
	SET @HTMLText = REPLACE(@HTMLText, '&uarr;',     NCHAR(8593))
	SET @HTMLText = REPLACE(@HTMLText, '&rarr;',     NCHAR(8594))
	SET @HTMLText = REPLACE(@HTMLText, '&darr;',     NCHAR(8595))
	SET @HTMLText = REPLACE(@HTMLText, '&harr;',     NCHAR(8596))
	SET @HTMLText = REPLACE(@HTMLText, '&crarr;',    NCHAR(8629))
	SET @HTMLText = REPLACE(@HTMLText, '&lceil;',    NCHAR(8968))
	SET @HTMLText = REPLACE(@HTMLText, '&rceil;',    NCHAR(8969))
	SET @HTMLText = REPLACE(@HTMLText, '&lfloor;',   NCHAR(8970))
	SET @HTMLText = REPLACE(@HTMLText, '&rfloor;',   NCHAR(8971))
	SET @HTMLText = REPLACE(@HTMLText, '&loz;',      NCHAR(9674))
	SET @HTMLText = REPLACE(@HTMLText, '&spades;',   NCHAR(9824))
	SET @HTMLText = REPLACE(@HTMLText, '&clubs;',    NCHAR(9827))
	SET @HTMLText = REPLACE(@HTMLText, '&hearts;',   NCHAR(9829))
	SET @HTMLText = REPLACE(@HTMLText, '&diams;',    NCHAR(9830))

	SET @HTMLText = REPLACE(@HTMLText, '&quot;',    '"')


    RETURN LTRIM(RTRIM(@HTMLText))
END
GO
